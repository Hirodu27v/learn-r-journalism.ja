<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/y0mN4HKKxaU?t=3s" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0; encrypted-media" allowfullscreen title="YouTube Video"></iframe>
</div>

##Rマークダウン

お気づきではないかもしれませんが、あなたはここに来るまでに、Rマークダウンが生成に役立ったさまざまなコンテンツに接しています。

* 各chapterサブフォルダーにあるHTML文書
* コードチャンクを個別に実行したノートブック
* コースにに流れをたどるために印刷できるPDF
* このlearn.r-journalism.comのサイト全体

R マークダウンは Rコードと **マークダウン**の組み合わせです。

<img src="/publishing/rmarkdown/images/rmdfiles.png">


## マークダウンとは何か?

ジョン･グルーバー（Daring Fireball）が作成したプレーンテキストにフォーマットを追加するための非常に簡単な方法です。この方法は非プログラミング型で、HTMLに直接変換でき、しかも読みやすく書きやすいのが特徴です。

下の画像では、左側のテキストは右側のHTMLとして認識されました。

<img src="/publishing/rmarkdown/images/markdown.png">

GitHubにはマークダウンについての [ためになるガイド](https://guides.github.com/features/mastering-markdown/) があります。

## Rマークダウン / .Rmd files

**Markdown** 文書にはRコードの塊（あるいはPythonのような他の言語）を簡単に埋め込むことができます。

あるレベルまでは、分析プロセスと結果をRの実行を必要としない形式で表示することができます。
しかし、コードは研究者または同僚のジャーナリストがあなたの仕事を複製するか、またはあなたの仕事に追加せざるをえない場合に備えて必要です。

これは[**文芸的プログラミング**](https://www-cs-faculty.stanford.edu/~knuth/lp.html)の一形態です。Rコードと文書を組み合わせることで、プログラミングはより堅牢で移植性が高くなり、保守が容易になります。

ボタンをクリックするか、コマンドをクリックすると、Rマークダウンファイルのコードを再実行して作業内容を再現し、その結果を完成したレポートとしてエクスポートできます。
Rマークダウンは、マークダウンに埋め込まれたコードを実行する [**knitr**](https://yihui.name/knitr/)パッケージとマークダウンをWord、PDF、HTMLなどのさまざまな出力形式に変換する [Pandoc](https://pandoc.org/)によって機能しています。

Rマークダウンは、以下に例を挙げた多数の静的および動的出力フォーマットをサポートします。

- HTML
- PDF
- MS Word
- Beamer
- HTML5 slideshows
- Tufte-style handouts
- Books
- Dashboards
- Scientific articles (white pages)
- Webサイト全体

---

## ジャーナリスト向けのフォーマット

### スマートな見た目のPDFを作成する

作品をPDFにエクスポートするのは効果的です。

*これを機能させるためには、まず [LaTex](https://www.latex-project.org/get/) をインストールしてください。*

<img src="/publishing/rmarkdown/images/pdf_output.png">


### IPython Notebooks

Notebooksはとても人気があります。

これがGitHubにアップロードしたときにpandasやipythonとレンダリングする方法です。

<img src="/publishing/rmarkdown/images/pythonnotebook.png" height="300">

うまくレンダリングされれば、その環境でコーディングしている他の誰かの経験と一致するはずです。

### .Rmd ファイルをGithubでレンダリングする

RマークダウンファイルはGitHubではどのように見えるでしょうか?

<img src="/publishing/rmarkdown/images/markdownoutput.png" height="300">

それぞれの.Rmdファイルの上部には独自のYAMLセクションがあります。 正しいパッケージと組み合わせると**knitr** に.Rmd ファイルの出力方法を指示します。 `toc: toc_float`のように、ヘッダーのタイトルに基づいて自己生成した目次を持つHTMLファイルを作成します。

GitHubはそれを解釈する方法を持っていないので、ネストされた画像を上に作成するだけで、目次を作ろうはしません。

**まあいいでしょう**

### Output .Rmd files to HTML

R Markdown will let you output as HTML, which you can still host on GitHub Pages (which we'll go over [later](http://learn.r-journalism.com/en/git/github_pages/github-pages/)). You may have to include links to the actual page but doing so can be more effective than having a .Rmd file "render" in a GitHub repo.

Rendering in HTML lets you add CSS and JavaScript, allowing for the inclusion of content like the interactive table below.

```{r datatable, warning=F, message=F}
library(DT)
library(dplyr)
library(readr)
payroll <- read_csv("../data/bostonpayroll2013.csv") %>% 
  select(NAME, TITLE, DEPARTMENT, REGULAR, OVERTIME) %>% 
  filter(row_number()<100)
datatable(payroll, extensions = 'Buttons', options = list(
    dom = 'Bfrtip',
    buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
  )
)
```

This table was rendered with the **DT** package. 

And we don't have to create the code to display it. 

It just worked because the folks who ported the [DataTables jquery plugin](https://datatables.net/) over to R wanted to make it seamless.

Pass certain arguments to the function `datatable()` and you can include buttons that allow reporters to download your tables as CSVs.

Can you imagine the power of that?

You've transformed the data collected it and then instead of sending them a huge spreadsheet, you send them a link to your report in which they can filter things out and download the table that they've come up with themselves.

You can render other interactives, as well, like [leaflet maps](https://learn.r-journalism.com/en/mapping/census_maps/census-maps/).

## Links not attachments!

This is a very important development as a journalist.

You see, reporters sometimes aren't very organized. 

How often have you had someone email you asking if you could resend your summarized spreadsheet to them again? 

This is what their downloads or desktop folder might look like. It's easy to see why they might have lost track of it.

<img src="/publishing/rmarkdown/images/bad_desktop.png">

Send them links instead!

### Host the HTML of your analysis

- On your internal work network or
- On [Github pages](https://github.com/wpinvestigative/kushner_eb5_census) (for free)
- Share with reporters and editors, let them explore your analysis further
- Let them download customized spreadsheets with buttons in the `DT` [(datatable) package](https://rstudio.github.io/DT/extensions.html)
- If your analysis gets updated, keep the file name then they only have to refresh their link

Repeat this process enough and maybe you can start learning how to create [Shiny apps](https://rstudio.github.io/shiny/tutorial/) with R.


# Creating R Markdown

Follow the instructions below.

### 1. Open a new .Rmd file

at **File > New File > R Markdown**. 

<div style="max-width:500px; margin-left:auto; margin-right:auto;"><img src="/publishing/rmarkdown/images/menu.png"></div>

Title the R Markdown file and select **HTML** as the output for now.

<div style="max-width:400px; margin-left:auto; margin-right:auto;"><img src="/publishing/rmarkdown/images/html.png"></div>

The default file created comes with code already included to give you a guidance on syntax and how it should be structured.

#### .Rmd structure

<div style="width:50%; margin-left:auto; margin-right:auto;"><img src="/publishing/rmarkdown/images/layout2.png"></div>

Every .Rmd file starts out the same at the top.

**YAML HEADER**

Optional section of render options written as **key:value** pairs.

- At start of file
- Between lines of **---** (3 dashes)

This is how R knows how to render your files. In the example above, the line`output: html_document` means it will create an HTML file. If it was `output: pdf` then you'd get a PDF instead.

*You can output more than one type at a time, if you want.*

**CODE CHUNKS**

In the image above, the R code is in the gray area.

These are chunks of embedded R code. Each chunk:

- begins with **```{r}** (the back tick key is to the left of 1)
- ends with **```**

**TEXT**

The rest of it is just the narrative of markdown interspersed in between the R code chunks.

You can also use HTML code instead of Markdown if that's what you're more comfortable with.

### 2. Write document

Edit the default template by putting in your own code and text.

Intersperse the text with your code to tell a story.

### 2b. Label your chunks of code

It'll be easier to navigate to in the future with the pull down menu at the bottom of the script window.

It also will be useful to narrow down where code errors might occur.

<img src="/publishing/rmarkdown/images/labels.png">

### 2c. Notebooks style

You can run individual chunks of code before generating the full report to see how it looks.

Click the green arrow next to each chunk. 

*Hopefully, you've already been doing this in our coding walkthroughs in class.* 

<img src="/publishing/rmarkdown/images/chunky.png">


### 3. Knit document to create report

Use knit button (the yarn ball!) at the top left or type **render()** to create the output file(s).

<div style="width:60%; margin-left:auto; margin-right:auto;"><img src="/publishing/rmarkdown/images/knit_button.png"></div>

### 3b. Check out the build log

Warnings and errors will appear in the console below.


Also measures progress by chunks, which is why it's important to label them.

<img src="/publishing/rmarkdown/images/console.png">

### 4. Preview output in RStudio window

<img src="/publishing/rmarkdown/images/preview.png">

### 5. Output file

You started with a .Rmd file and clicking knit HTML also generated a .html file.

<div style="width:50%; margin-left:auto; margin-right:auto;"><img src="/publishing/rmarkdown/images/testpage.png"></div>

It's all there in your project folder now.

Next, we'll go over more specific features in R Markdown files that will give you more control on how its presented.


-----
