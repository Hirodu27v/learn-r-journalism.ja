---
title: "Copying and pasting data"
author: "Andrew Ba Tran"
date: 2018-05-27T21:13:14-05:00
categories: ["R"]
tags: ["R", "importing", "copying", "pasting"]
weight: 5
slug: copying-pasting
---


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/3W9m2iyfoGk?t=2s" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0; encrypted-media" allowfullscreen title="YouTube Video"></iframe>
</div>

あらかじめ作られたフォーマットでなければ、Rにデータを取り込むのはとても難しいものです。

Webサイトの表データがそうですが、これは一般的ではないフォーマット構造のExcelスプレッドシートやPDFにも当てはまります。

データを実行可能なデータフレームに変換するために、ウェブサイトからデータをスクレイピングし、ExcelまたはPDFからデータをインポートする手順を踏むことによって、文書作成者としてプロセスの統制をとることができます。

[Datapasta](https://github.com/MilesMcBain/datapasta)はこれらのステップを省略し、ユーザーがテーブルに構造化されたデータを別の場所からコピーしてRStudioに直接貼り付けることを可能にします。

**データをすぐに使いたい時**

![実行中のDatapasta](/importing_exporting/copying_pasting/images/datapasta.gif)

{{% notice note %}}
これから **datapasta** の使用法を示しますが、それはプロジェクトにドキュメントを追加するときに、データを正しく取り込むこことを　*前提* にしているからです。
{{% /notice %}}

`tribble()`とは何でしょうか？ この新しいパッケージはより人間が読める方法でデータフレームを構築することを可能にします。 [tibbleをチェックしてください](https://cran.r-project.org/web/packages/tibble/vignettes/tibble.html)。

DatapastaはキーボードショートカットとRStudioに依存しています。 したがって明確なコマンドがなくても、上のGIFに魔法のように表示されます。説明しましょう。

### 以下のパッケージをインストールしてロードする

```{r setup, warning=F, message=F}
# install.packages("datapasta")
library(datapasta)

# install.packages("tibble")
library(tibble)
```

**Tools > Addins > Browse Addins...** と進んでください。

![Browse](/importing_exporting/copying_pasting/images/datapasta1.png)

次に **キーボードショートカット** をクリックします。

![Browse](/importing_exporting/copying_pasting/images/datapasta2.png)

 **ショートカット** 列で作成しているデータの種類ごとにキーボードショートカットを追加します。 **ショートカット** 列の空白部分をクリックする必要があります。

![Browse](/importing_exporting/copying_pasting/images/datap.png)


これらのショートカットコマンドをお勧めしますが、必要に応じてカスタムコマンドを作成してください。

インターネット・ブロードウェイ・データベースから、 [「ハミルトン」に関する統計」](https://www.ibdb.com/grosses-production/hamilton-499521/1)を調べてみます。

![Browse](/importing_exporting/copying_pasting/images/datapasta4.png)

テーブル内のデータを選択してRStudioを開き、ショートカットを使ってチブルを持ってきてください（私は、shift + cmd + Tを使いました）。

このようなデータを得るはずです。

```{r tibble,  results='hide'}
tribble(
    ~Week.Ending,       ~Gross, ~X..Gross.Pot., ~Attendance, ~X..Capacity, ~X..Previews, ~X..Perf.,
  "May 22, 2016", "$1,764,808",         "132%",    "10,755",       "102%",            0,         8,
  "May 15, 2016", "$1,686,168",         "126%",    "10,736",       "102%",            0,         8,
   "May 8, 2016", "$1,833,473",         "137%",    "10,754",       "102%",            0,         8,
   "May 1, 2016", "$1,818,758",         "136%",    "10,754",       "102%",            0,         8,
  "Apr 24, 2016", "$1,813,024",         "136%",    "10,753",       "102%",            0,         8,
  "Apr 17, 2016", "$1,678,620",         "126%",    "10,732",       "102%",            0,         8,
  "Apr 10, 2016", "$1,813,655",         "136%",    "10,754",       "102%",            0,         8,
   "Apr 3, 2016", "$1,822,594",         "137%",    "10,752",       "102%",            0,         8,
  "Mar 27, 2016", "$1,719,570",         "129%",    "10,755",       "102%",            0,         8,
  "Mar 20, 2016", "$1,740,104",         "130%",    "10,753",       "102%",            0,         8,
  "Mar 13, 2016", "$1,758,555",         "132%",    "10,756",       "102%",            0,         8,
   "Mar 6, 2016", "$1,766,223",         "132%",    "10,751",       "102%",            0,         8,
  "Feb 28, 2016", "$1,755,010",         "131%",    "10,756",       "102%",            0,         8,
  "Feb 21, 2016", "$1,750,924",         "131%",    "10,756",       "102%",            0,         8
  )
```

このプロセスにはいくつかエラーがあります。パーセント記号がXに変換されず、特殊文字が原因で失敗したためです。コンソールでコマンドを実行する前に、手動で置き換える必要があるかもしれません。

オブジェクトに割り当てることを忘れないでください。

```{r assign}
new_table <- tribble(
    ~Week.Ending,       ~Gross, ~X..Gross.Pot., ~Attendance, ~X..Capacity, ~X..Previews, ~X..Perf.,
  "May 22, 2016", "$1,764,808",         "132%",    "10,755",       "102%",            0,         8,
  "May 15, 2016", "$1,686,168",         "126%",    "10,736",       "102%",            0,         8,
   "May 8, 2016", "$1,833,473",         "137%",    "10,754",       "102%",            0,         8,
   "May 1, 2016", "$1,818,758",         "136%",    "10,754",       "102%",            0,         8,
  "Apr 24, 2016", "$1,813,024",         "136%",    "10,753",       "102%",            0,         8,
  "Apr 17, 2016", "$1,678,620",         "126%",    "10,732",       "102%",            0,         8,
  "Apr 10, 2016", "$1,813,655",         "136%",    "10,754",       "102%",            0,         8,
   "Apr 3, 2016", "$1,822,594",         "137%",    "10,752",       "102%",            0,         8,
  "Mar 27, 2016", "$1,719,570",         "129%",    "10,755",       "102%",            0,         8,
  "Mar 20, 2016", "$1,740,104",         "130%",    "10,753",       "102%",            0,         8,
  "Mar 13, 2016", "$1,758,555",         "132%",    "10,756",       "102%",            0,         8,
   "Mar 6, 2016", "$1,766,223",         "132%",    "10,751",       "102%",            0,         8,
  "Feb 28, 2016", "$1,755,010",         "131%",    "10,756",       "102%",            0,         8,
  "Feb 21, 2016", "$1,750,924",         "131%",    "10,756",       "102%",            0,         8
  )

```

どうでしょうか?

```
View(new_table)

```

![](/importing_exporting/copying_pasting/images/new_table.png)

シンプル!

これで、列名を整理したり、コンマ、ドル記号、パーセント記号などを削除したりして、データの分析や視覚化を行うことができます。 （後で詳しく説明します）

ショートカットの代わりにtibbleを使用してデータフレームを作成したのはなぜだと思いますか。tibbleパッケージは特殊な記号をそのままにして、情報を持ち込むことに寛容です。 ショートカットを使って **shift+cmd+D** でデータフレームを取り込むと、RStudioはエラーを表示します。

## ベクトルにdatapastaを使う

データフレーム全体ではなく、配列だけが欲しい場合もあります。

 **(shift+cmd+V)** のショートカットを使ってベクトルとして貼り付けると、ハミルトンのデータの１行は次のようになります。

```{r vector}
c("May 22", " 2016", "$1", "764", "808", "132%", "10", "755", "102%", "0", "8")
```

別の方法は、各要素をそれぞれ別の行に貼り付けることです。データリストがとても長いとき、要素を見つけるために右にスクロールする必要がないので便利です。お勧めのショートカットは **shift+cmd+alt+V**　です。

```{r vector2}
c("May 22",
  " 2016",
  "$1",
  "764",
  "808",
  "132%",
  "10",
  "755",
  "102%",
  "0",
  "8")
```


-----

